/**
  * plate-map - JavaScript Plate Layout is an open source tool developed collaboratively by [Chai Biotechnologies](www.chaibio.com) and [New England Biolabs](www.neb.com) for visualizing and editing the layout of scientific assay plates.
  * @version v1.0.0
  * @link https://github.com/slohr/plate-map
  * @license MIT
  */
var plateLayOutWidget=plateLayOutWidget||{};!function(t,e){t.widget("DNA.plateLayOut",{plateLayOutWidget:{},options:{value:0},columnCount:12,rowIndex:["A","B","C","D","E","F","G","H"],allTiles:[],_create:function(){this.options.created=function(t,e){e.target=t.target.id?"#"+t.target.id:"."+t.target.className},this._trigger("created",null,this);var e=this;window.addEventListener("keyup",function(t){t.preventDefault(),e._handleShortcuts(t)});for(var a in plateLayOutWidget)t.extend(this,new plateLayOutWidget[a](this));return this.imgSrc=this.options.imgSrc||"assets",this.tabContainerId=this.options.tabContainerId||"",this.dataContainerId=this.options.dataContainerId||"",this.updateOnUndoRedo="undefined"==typeof this.options.updateOnUndoRedo?!1:this.options.updateOnUndoRedo,this.showPresetTabs="undefined"==typeof this.options.showPresetTabs?!0:this.options.showPresetTabs,this.updateOnClearCriteria="undefined"==typeof this.options.updateOnClearCriteria?!1:this.options.updateOnClearCriteria,this.updateOnPasteCriteria="undefined"==typeof this.options.updateOnPasteCriteria?!1:this.options.updateOnPasteCriteria,this._createInterface(),this._configureUndoRedoArray(),this.onOffCheckBox(!1,"preset 1"),this},_init:function(){},addData:function(){}})}(jQuery,fabric),function(t,e){plateLayOutWidget.loadPlate=function(e){return{getPlates:function(e){var a=e;this.clearCheckBoxes(),this.clearCrieteriaForAll(a.selectedObjects),this.loadDataToCircles(a.derivative),this.engine.derivative=t.extend(!0,{},a.derivative),t.isEmptyObject(a.checkboxes)?this._colorMixer(!0):this.loadCheckboxes(a.checkboxes),a.selectedObjects&&a.selectedObjects.selectionRectangle&&this.createRectangle(a.selectedObjects.selectionRectangle,a.selectedObjects.click)},loadDataToCircles:function(e){for(var a in e)this.allTiles[a].wellData=t.extend(!0,{},e[a].wellData)},loadCheckboxes:function(e){var a;for(var i in e)a=t("#"+i).data("checkBox"),t(a).data("clicked",!1).trigger("click",!0)},clearCheckBoxes:function(){var e;for(var a in this.globalSelectedAttributes)e=t("#"+a).data("checkBox"),t(e).data("clicked",!0).trigger("click",!0)},createRectangle:function(t,e){this.startX=t.left,this.startY=t.top,"dynamicRect"==t.type?(this.mouseMove=!0,this._createDynamicRect(),this.dynamicRect.setWidth(t.width),this.dynamicRect.setHeight(t.height)):this.mouseMove=!1,this.mainFabricCanvas.fire("mouse:up")}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.addDataOnChange=function(){return{_addData:function(t,e){if(this.allSelectedObjects){for(var a=this.allSelectedObjects.length,i=0;a>i;i++){var n=this.allSelectedObjects[i].wellData;n[t.target.id]=t.target.value,this.engine.createDerivative(this.allSelectedObjects[i])}this._trigger("updateWells",null,this.createObject()),this._colorMixer(!0)}},_colorMixer:function(t){if(!t)for(var e in this.engine.derivative)this.engine.createDerivative(this.allTiles[e]);if(!this.undoRedoActive){var a=this.createObject();this.addToUndoRedo(a)}this.engine.searchAndStack().applyColors(),this.mainFabricCanvas.renderAll()},_addUnitData:function(t){if(this.allSelectedObjects){for(var e=this.allSelectedObjects.length,a=0;e>a;a++){var i=this.allSelectedObjects[a].unitData;i[t.target.id]=t.target.value,this.engine.createDerivative(this.allSelectedObjects[a])}this._trigger("updateWells",null,this.createObject()),this._colorMixer(!0)}},createObject:function(){var t={startingTileIndex:this.startingTileIndex,rowCount:this.rowCount,columnCount:this.columnCount,click:this.clicked||!1};if(this.dynamicRect){var e={type:"dynamicRect",width:this.dynamicRect.width,height:this.dynamicRect.height,left:this.startX,top:this.startY,mouseMove:this.mouseMove};t.selectionRectangle=e}else if(this.dynamicSingleRect){var e={type:"dynamicSingleRect",width:this.dynamicSingleRect.width,height:this.dynamicSingleRect.height,left:this.startX,top:this.startY,mouseMove:this.mouseMove};t.selectionRectangle=e}var a={derivative:this.engine.derivative,checkboxes:this.globalSelectedAttributes,selectedObjects:t};return a}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.addDataToFields=function(){return{_addDataToTabFields:function(){var e=this.allSelectedObjects[0].wellData;for(var a in e)this._applyFieldData(a,e);var i=this.allSelectedObjects[0].unitData;for(var n in i)this._applyUnitData(n,i);var s=this.globalSelectedAttributes;for(var l in s)if(1==s[l]){var r=t("#"+l).data("checkBox");t(r).attr("src",this.imgSrc+"/do.png").data("clicked",!0)}},_applyFieldData:function(e,a){switch(t("#"+e).data("type")){case"multiselect":t("#"+e).val(a[e]).trigger("change","Automatic");break;case"combobox":t("#"+e).select2("data",{id:a[e],text:a[e]}),t("#"+e).trigger("change","Automatic");break;case"text":t("#"+e).val(a[e]);break;case"textarea":t("#"+e).val(a[e]);break;case"numeric":t("#"+e).val(a[e]);break;case"boolean":var i="";1==a[e]||"true"==a[e]?i="true":(0==a[e]||"false"==a[e])&&(i="false"),t("#"+e).val(i).trigger("change","Automatic")}},_applyUnitData:function(e,a){t("#"+e).val(a[e]).trigger("change","Automatic")},compareObjects:function(t,e){for(var a in e)if(e[a]!==t[a])return!1;for(var a in t)if(t[a]!==e[a])return!1;return!0},_clearAllFields:function(e){var a=t.extend({},e);for(var i in a)a[i]="boolean"==t("#"+i).data("type")?null:"",this._applyFieldData(i,a)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.addTabData=function(){return{requiredFields:[],_addTabData:function(){var e=this.options.attributes.tabs,a=0;for(currentTab in e){if(e[currentTab].fields){var i=[],n=0;for(field in e[currentTab].fields){e[currentTab].fields[field].required&&this.requiredFields.push(e[currentTab].fields[field].id);var s=e[currentTab].fields[field],l=this._createField(s);s.id&&s.type&&(this.allWellData[s.id]="boolean"==s.type?"NULL":""),t(l).data("type",s.type),t(l).data("caption",field),i[n++]=this._createDefaultFieldForTabs(),t(i[n-1]).find(".plate-setup-tab-name").html(s.name),t(this.allDataTabs[a]).append(i[n-1]),t(i[n-1]).find(".plate-setup-tab-field-container").html(l);var r=this._addCheckBox(i,n,s);t(l).data("checkBox",r),this._addTabFieldEventHandlers(i,n,s,l)}this.allDataTabs[a].fields=i}a++}},_createField:function(t){switch(t.type){case"text":return this._createTextField(t);case"textarea":return this._createTextAreaField(t);case"numeric":return this._createNumericField(t);case"multiselect":return this._createMultiSelectField(t);case"combobox":return this._createComboBoxField(t);case"boolean":return this._createBooleanField(t)}},_addTabFieldEventHandlers:function(e,a,i,n){var s=this;switch(i.type){case"combobox":i.options?t("#"+i.id).select2({allowClear:!0,multiple:!1,data:i.options,createSearchChoice:function(e,a){return 0===t(a).filter(function(){return 0===this.text.localeCompare(e)}).length?{id:e,text:e}:void 0}}):i.ajax_options_url?t("#"+i.id).select2({allowClear:!0,multiple:!1,ajax:{url:i.ajax_options_url,dataType:"json",quietMillis:250,data:function(t,e){return{q:t}},results:function(t,e){return{results:t}},cache:!0},formatNoMatches:function(t){return i.ajax_add_new_url?"<input class='form-control' id='newOption' value='"+t+"'><a href='#' id='addNew' class='btn btn-default'>Create</a>":"No Matches"}}).parent().find(".select2-with-searchbox").on("click","#addNew",function(){var e=t("#newOption").val();t.ajax({url:i.ajax_add_new_url,type:"POST",data:{newOption:e},success:function(e){t("#"+i.id).select2("data",e[0]),t("#"+i.id).select2("close"),t("#"+i.id).trigger("change")},error:function(t,e,a){}})}):t("#"+i.id).select2({allowClear:!0,multiple:!1,data:[],createSearchChoice:function(e,a){return 0===t(a).filter(function(){return 0===this.text.localeCompare(e)}).length?{id:e,text:e}:void 0}}),t("#"+i.id).on("change",function(t,e){"Automatic"!=e&&s._addData(t)});break;case"multiselect":t("#"+i.id).select2({allowClear:!0}),t("#"+i.id).on("change",function(t,e){"Automatic"!=e&&s._addData(t)});break;case"numeric":t(n).keydown(function(t){var e=t.which?t.which:t.keyCode;return 190!=e&&8!=e&&0!=e&&(48>e||e>57)?!1:void 0}),t(n).keyup(function(t){var e=t.which?t.which:t.keyCode;190!=e&&8!=e&&0!=e&&(48>e||e>57)||s._addData(t)});var l=this._addUnitDataField(e,a,i);e[a-1].unit=l;break;case"boolean":t("#"+i.id).select2({allowClear:!0,minimumResultsForSearch:-1}),t("#"+i.id).on("change",function(t,e){"Automatic"!=e&&s._addData(t)});break;case"text":t("#"+i.id).keyup(function(t){t.preventDefault(),i.updateOnReturn?13==t.which&&s._addData(t):90==t.keyCode&&t.ctrlKey||89==t.keyCode&&t.ctrlKey||17!=t.which&&s._addData(t)});break;case"textarea":t("#"+i.id).keyup(function(t){t.preventDefault(),i.updateOnReturn?13==t.which&&s._addData(t):90==t.keyCode&&t.ctrlKey||89==t.keyCode&&t.ctrlKey||17!=t.which&&s._addData(t)})}}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.applyWellData=function(){return{_addWellDataToAll:function(){for(var e=this.allTiles.length,a=0;e>a;a++)this.allTiles[a].wellData=t.extend(!0,{},this.allWellData)},_addUnitDataToAll:function(){for(var e=this.allTiles.length,a=0;e>a;a++)this.allTiles[a].unitData=t.extend(!0,{},this.allUnitData)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.bottomTable=function(){return{_bottomScreen:function(){this.dataContainerId||0!==t("#"+this.dataContainerId).length?this.dataContainerId&&"off"===this.dataContainerId||(this.bottomContainer=t("#"+this.dataContainerId).addClass("plate-setup-bottom-container")):(this.bottomContainer=this._createElement("<div></div>").addClass("plate-setup-bottom-container"),t(this.container).append(this.bottomContainer))},addBottomTableHeadings:function(){this.bottomRow=this._createElement("<div></div>").addClass("plate-setup-bottom-row");var e=this._createElement("<div></div>").addClass("plate-setup-bottom-single-field").html("<div>Plate ID</div>");t(this.bottomRow).addClass("plate-setup-bottom-row-seperate").prepend(e),t(this.bottomContainer).html(this.bottomRow),this.rowCounter=1;for(var a in this.globalSelectedAttributes){var i=t("#"+a).data("caption"),e=this._createElement("<div></div>").addClass("plate-setup-bottom-single-field").html("<div>"+i+"</div>");t(this.bottomRow).append(e),this.rowCounter=this.rowCounter+1}this.adjustFieldWidth(this.bottomRow)},addBottomTableRow:function(e,a){var i=this.allTiles[a[0]],n=this._createElement("<div></div>").addClass("plate-setup-bottom-row-data"),s=this._createElement("<div></div>").addClass("plate-setup-bottom-single-field-data");this.engine.stackPointer<=this.colorPairs.length/2+1?t(s).css("background","-webkit-linear-gradient(left, "+this.valueToColor[color]+" , "+this.colorPairObject[this.valueToColor[color]]+")"):t(s).html(e),t(n).append(s);for(var l in this.globalSelectedAttributes){var r="NULL"==i.wellData[l]?"":i.wellData[l],o=this._createElement("<div></div>").addClass("plate-setup-bottom-single-field-data").html(r);t(n).append(o)}t(this.bottomContainer).append(n),this.adjustFieldWidth(n)},bottomForFirstTime:function(){this.addBottomTableHeadings();var e=this._createElement("<div></div>").addClass("plate-setup-bottom-row-data"),a={0:this.colorPairs[0],1:this.colorPairs[1]},i=this._createElement("<div></div>").addClass("plate-setup-bottom-single-field-data");t(i).css("background","-webkit-linear-gradient(left, "+a[0]+" , "+a[1]+")"),t(e).append(i),t(this.bottomContainer).append(e)},adjustFieldWidth:function(e){var a=this.rowCounter;150*a>1024&&t(e).css("width",152*a+"px")}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.canvasCircles=function(){return{addCircle:function(t,a,i){var n=new e.Circle({radius:22,originX:"center",originY:"center",top:t.top,left:t.left,shadow:"rgba(0,0,0,0.3) 0 2px 2px",evented:!1});n.colorIndex=a;var s=new e.Circle({radius:14,fill:"white",originX:"center",originY:"center",top:t.top,left:t.left,shadow:"rgba(0,0,0,0.1) 0 -1px 0",evented:!1}),l=new e.IText(""+n.colorIndex,{top:t.top,left:t.left,fill:"black",evented:!1,fontSize:12,lockScalingX:!0,lockScalingY:!0,originX:"center",originY:"center",visible:!1});n.parent=t,t.circle=n,t.circleCenter=s,t.circleText=l,this.setGradient(n,a,i),this.mainFabricCanvas.add(n),this.mainFabricCanvas.add(s),this.mainFabricCanvas.add(l)},setGradient:function(t,e,a){var i=t.parent;if(i.circleText.text=""+parseInt(e)-1+"",a<=this.colorPairs.length/2+1){var n={0:this.valueToColor[e],1:this.colorPairObject[this.valueToColor[e]]};i.circleText.setVisible(!1)}else{i.circleText.setVisible(!0);var n={0:"#ffc100",1:"#ff6a00"}}t.setGradient("fill",{x1:0,y1:0,x2:0,y2:t.height,colorStops:n})}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.canvas=function(){return{allSelectedObjects:null,allPreviouslySelectedObjects:null,colorPointer:0,goldenRatio:.618033988749895,_createCanvas:function(){this.normalCanvas=this._createElement("<canvas>").attr("id","DNAcanvas"),t(this.canvasContainer).append(this.normalCanvas)},_initiateFabricCanvas:function(){this.mainFabricCanvas=new e.Canvas("DNAcanvas",{backgroundColor:"#f5f5f5",selection:!0,stateful:!1,hoverCursor:"pointer",renderOnAddRemove:!1}).setWidth(632).setHeight(482)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.checkBox=function(){return{globalSelectedAttributes:{},_addCheckBox:function(e,a,i){var n=t("<img>").attr("src",this.imgSrc+"/dont.png").addClass("plate-setup-tab-check-box").data("clicked",!1).data("linkedFieldId",i.id);return t(e[a-1]).find(".plate-setup-tab-field-left-side").html(n),this._applyCheckboxHandler(n),e[a-1].checkbox=n,n},_applyCheckboxHandler:function(e){var a=this;t(e).click(function(e,i){t(this).data("clicked")?t(this).attr("src",a.imgSrc+"/dont.png"):t(this).attr("src",a.imgSrc+"/do.png"),t(this).data("clicked",!t(this).data("clicked")),a._addRemoveSelection(t(this)),a.previousPreset&&!i&&t(a.previouslyClickedPreset).trigger("click",!0)})},_addRemoveSelection:function(t){t.data("clicked")?(this.globalSelectedAttributes[t.data("linkedFieldId")]=!0,this._colorMixer(!1)):(delete this.globalSelectedAttributes[t.data("linkedFieldId")],this._colorMixer(!1))}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.colorManager=function(){return{colorPairs:["#e10404","#500000","#f8666c","#970e10","#ff9600","#ff3600","#ffc100","#ff6a00","#ffd5ed","#ffb1df","#ffe735","#ffaa0e","#fff77a","#ffe021","#dbfa89","#bcf61f","#a9eac9","#2eb146","#376a00","#254800","#84f0ff","#5feaff","#2ea2be","#113d55","#003d7d","#001021","#a316e7","#750edb","#a70075","#5e0040","#ee11ee","#c803c8","#5c5c5c","#423a42","#a3a3a3","#6f6f6f"],colorPairObject:{"#e10404":"#500000","#f8666c":"#970e10","#ff9600":"#ff3600","#ffc100":"#ff6a00","#ffd5ed":"#ffb1df","#ffe735":"#ffaa0e","#fff77a":"#ffe021","#dbfa89":"#bcf61f","#a9eac9":"#2eb146","#376a00":"#254800","#84f0ff":"#5feaff","#2ea2be":"#113d55","#003d7d":"#001021","#a316e7":"#750edb","#a70075":"#5e0040","#ee11ee":"#c803c8","#5c5c5c":"#423a42","#a3a3a3":"#6f6f6f"},colorIndexValues:{"#e10404":1,"#f8666c":2,"#ff9600":3,"#ffc100":4,"#ffd5ed":5,"#ffe735":6,"#fff77a":7,"#dbfa89":8,"#a9eac9":9,"#376a00":10,"#84f0ff":11,"#2ea2be":12,"#003d7d":13,"#a316e7":14,"#a70075":15,"#ee11ee":16,"#5c5c5c":17,"#a3a3a3":18},valueToColor:{1:"#e10404",2:"#f8666c",3:"#ff9600",4:"#ffc100",5:"#ffd5ed",6:"#ffe735",7:"#fff77a",8:"#dbfa89",9:"#a9eac9",10:"#376a00",11:"#84f0ff",12:"#2ea2be",13:"#003d7d",14:"#a316e7",15:"#a70075",16:"#ee11ee",17:"#5c5c5c",18:"#a3a3a3"},getColor:function(){}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.createCanvasElements=function(){return{spacing:48,_canvas:function(){this._fixRowAndColumn(),this._putCircles()},_fixRowAndColumn:function(){for(var t=1;t<=this.columnCount;t++){var a=new e.IText(t.toString(),{fill:"black",originX:"center",originY:"center",fontSize:12,top:10,left:this.spacing+(t-1)*this.spacing,fontFamily:"Roboto",selectable:!1,fontWeight:"400"});this.mainFabricCanvas.add(a)}for(var t=0;this.rowIndex[t];){var a=new e.IText(this.rowIndex[t],{fill:"black",originX:"center",originY:"center",fontSize:12,left:5,top:this.spacing+t*this.spacing,fontFamily:"Roboto",selectable:!1,fontWeight:"400"});this.mainFabricCanvas.add(a),t++}},_putCircles:function(){for(var t=this.rowIndex.length,a=0,i=0;t>i;i++)for(var n=0;12>n;n++){var s=new e.Rect({width:48,height:48,left:this.spacing+n*this.spacing,top:this.spacing+i*this.spacing,fill:"#f5f5f5",originX:"center",originY:"center",name:"tile-"+i+"X"+n,type:"tile",hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,index:a++,wellData:{},selectedWellAttributes:{}});this.allTiles.push(s),this.mainFabricCanvas.add(s)}this._addImages()},_addImages:function(){var a=this,i=this.allTiles.length;e.Image.fromURL(this.imgSrc+"/background-pattern.png",function(n){e.Image.fromURL(a.imgSrc+"/empty-well.png",function(e){for(var s=0;i>s;s++){var l=t.extend({},e),r=t.extend({},n),o=a.allTiles[s];l.top=r.top=o.top,l.left=r.left=o.left,l.parent=o,l.originX=r.originX="center",l.originY=r.originY="center",l.hasControls=r.hasControls=!1,l.hasBorders=r.hasBorders=!1,l.lockMovementX=r.lockMovementX=!0,l.lockMovementY=r.lockMovementY=!0,l.evented=r.evented=!1,l.type="image",r.visible=!1,a.allTiles[s].notSelected=l,a.allTiles[s].backgroundImg=r,a.mainFabricCanvas.add(r,l)}a.mainFabricCanvas.renderAll()}),a._addLargeRectangleOverlay()}),this._addWellDataToAll(),this._addUnitDataToAll(),this._fabricEvents()},_addLargeRectangleOverlay:function(){this.overLay=new e.Rect({width:632,height:482,left:0,top:0,opacity:0,originX:"left",originY:"top",lockMovementY:!0,lockMovementX:!0,selectable:!1}),this.mainFabricCanvas.add(this.overLay)}}},plateLayOutWidget.createField=function(){return{_createTextAreaField:function(t){return this._createElement("<textarea>").addClass("plate-setup-tab-textarea").attr("id",t.id)},_createComboBoxField:function(t){return this._createElement("<input>").addClass("plate-setup-tab-input").attr("id",t.id)},_createTextField:function(t){return this._createElement("<input>").addClass("plate-setup-tab-input").attr("id",t.id)},_createMultiSelectField:function(e){var a=this._createElement("<select></select>").attr("id",e.id).addClass("plate-setup-tab-select-field"),i=this._createElement("<option></option>").attr("value","").html("");t(a).append(i);for(options in e.options){var n=e.options[options],s=this._createElement("<option></option>").attr("value",n.name).html(n.name);t(a).append(s)}return a},_createNumericField:function(t){var e=this._createElement("<input>").addClass("plate-setup-tab-input").attr("placeholder",t.placeholder||"").attr("id",t.id);return e},_createBooleanField:function(e){var a=this._createElement("<select></select>").attr("id",e.id).addClass("plate-setup-tab-select-field"),i=this._createElement("<option></option>").attr("value",null).html(""),n=this._createElement("<option></option>").attr("value",!0).html("true"),s=this._createElement("<option></option>").attr("value",!1).html("false");return t(a).append(i).append(n).append(s),a}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.engine=function(e){return{engine:{derivative:{},stackUpWithColor:{},stackPointer:2,currentPercentage:0,wholePercentage:0,wholeNoTiles:0,createDerivative:function(a){var i=this.getSelectedValues(a),n=t.extend(!0,{},e.globalSelectedAttributes),s=this.getUnits(a),l=t.extend(!0,{},a.wellData);this.derivative[a.index]={selectedValues:i,attrs:n,units:s,wellData:l}},getSelectedValues:function(t){var a={};for(var i in e.globalSelectedAttributes)t.wellData[i]&&"NULL"!=t.wellData[i]&&(a[i]=t.wellData[i]);return a},getUnits:function(t){var a={};for(var i in e.globalSelectedAttributes)t.unitData[i+"unit"]&&(a[i+"unit"]=t.unitData[i+"unit"]);return a},searchAndStack:function(){this.stackUpWithColor={},this.stackPointer=2;for(var a=JSON.parse(JSON.stringify(this.derivative));!t.isEmptyObject(a);){var i=Object.keys(a)[0],n=a[i],s=[];if(t.isEmptyObject(n.selectedValues))this.stackUpWithColor[1]?this.stackUpWithColor[1].push(i):this.stackUpWithColor[1]=[i],delete a[i];else{for(data in a)e.compareObjects(n.selectedValues,a[data].selectedValues)&&e.compareObjects(n.units,a[data].units)&&(s.push(data),this.stackUpWithColor[this.stackPointer]=s,delete a[data]);data.length>0&&this.stackPointer++}}return this},applyColors:function(){this.wholeNoTiles=0,this.currentPercentage=0,this.wholePercentage=0,e.addBottomTableHeadings();for(color in this.stackUpWithColor){e.addBottomTableRow(color,this.stackUpWithColor[color]);for(tileIndex in this.stackUpWithColor[color])this.wholeNoTiles++,tile=e.allTiles[this.stackUpWithColor[color][tileIndex]],tile.circle?e.setGradient(tile.circle,color,this.stackPointer):e.addCircle(tile,color,this.stackPointer),this.wholePercentage=this.wholePercentage+this.checkCompletion(tile.wellData,tile),this.checkForValidData(tile)}this.wholePercentage=Math.floor(this.wholePercentage/(100*this.wholeNoTiles)*100),t(e.overLayTextContainer).html(isNaN(this.wholePercentage)?"Completion Percentage: 0%":"Completion Percentage: "+this.wholePercentage+"%")},checkForValidData:function(t){for(var a in t.wellData)if(""!=t.wellData[a]&&"NULL"!=t.wellData[a])return!0;return e.clearSingleCrieteria(t),!1},checkCompletion:function(t,a){for(var i=e.requiredFields.length,n=i,s=0;i>s;s++)(""==t[e.requiredFields[s]]||"NULL"==t[e.requiredFields[s]])&&(a.circleCenter.radius=14,n--);return n!=i?n/i*100:(a.circleCenter.radius=8,100)},findCommonValues:function(t){var a=JSON.parse(JSON.stringify(e.allSelectedObjects[0][t]));return e.allSelectedObjects.filter(function(e,i){for(var n in a)a[n]!=e[t][n]&&(a[n]="")}),a}}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.fabricEvents=function(){return{colorToIndex:{},_fabricEvents:function(){var e=this;this.mainFabricCanvas.on("object:selected",function(t){e._deselectSelected(),e.allSelectedObjects=t.target?t.target._objects||[t.target]:t,e._selectTiles(),e._addPreset(),e._applyValuesToTabs(),e.mainFabricCanvas.renderAll()}),t(e.target).on("getPlates",function(t,a){e.getPlates(JSON.parse(a))});var a=15,i=65,n=1024,s=768+a;e.mainFabricCanvas.on("mouse:down",function(n){e.mouseDown=!0,e._deselectSelected(),e.mainFabricCanvas.remove(e.dynamicRect),e.mainFabricCanvas.remove(e.dynamicSingleRect),e.dynamicRect=!1;var s=t(window).scrollTop(),l=e.element.find(".plate-setup-wrapper").offset().top,r=e.element.find(".plate-setup-wrapper").offset().left;e.startX=n.e.clientX-a-r,e.startY=n.e.clientY-i+s-l}),e.mainFabricCanvas.on("mouse:move",function(n){var s=n.e.x||n.e.clientX,l=n.e.y||n.e.clientY;!e.dynamicRect&&e.mouseDown&&(e.mouseMove=!0,e._createDynamicRect(n));var r=t(window).scrollTop(),o=e.element.find(".plate-setup-wrapper").offset().top,c=e.element.find(".plate-setup-wrapper").offset().left;e.dynamicRect&&e.mouseDown&&s>e.spacing&&l>e.spacing&&(e.dynamicRect.setWidth(s-e.startX-a-c),e.dynamicRect.setHeight(l+r-e.startY-i-o),e.mainFabricCanvas.renderAll())}),e.mainFabricCanvas.on("mouse:up",function(t){e.mouseDown=!1,e.mouseMove?e._decideSelectedFields(e.dynamicRect)&&e._alignRectangle(e.dynamicRect):t.e&&t.e.y<s&&t.e.x<n&&(e._createDynamicSingleRect(t),e._decideSelectedFields(e.dynamicSingleRect,!0),e._alignRectangle(e.dynamicSingleRect)),e.mouseMove=!1,e.mainFabricCanvas.renderAll()})},_alignRectangle:function(t){var e=this.allSelectedObjects[0],a=this.allSelectedObjects[this.allSelectedObjects.length-1];e?(t.left=e.left-25,t.top=e.top-25,1===this.allSelectedObjects.length?(t.setWidth(this.spacing),t.setHeight(this.spacing)):(t.setWidth(a.left-t.left+24),t.setHeight(a.top-t.top+24)),t.rx=5,t.ry=5):t.setVisible(!1)},_decideSelectedFields:function(t,e){t.width<0&&(t.left=t.left+t.width,t.width=-1*t.width),t.height<0&&(t.top=t.top+t.height,t.height=-1*t.height);var a=this.spacing,i=a/2,n=t.top,s=t.left,l=t.width,r=t.height,o=s+l,c=n+r;if(t.left<25&&(s=25,o-=25-t.left),t.top<25&&(n=25,c-=25-t.top),t.top>404)return this.mainFabricCanvas.remove(t),!1;o>=580&&(o=580),c>=400&&(c=400),e||(Math.floor(s/i)%2===0&&(s+=i),Math.floor(n/i)%2===0&&(n+=i),Math.floor(o/i)%2!=0&&(o-=i),Math.floor(c/i)%2!=0&&(c-=i));{var d=Math.round(s/a)-1+12*(Math.round(n/a)-1);Math.round(o/a)+12*Math.round(c/a)}return this.startingTileIndex=d,this.clicked=e,this.rowCount=Math.round(c/a)-Math.round(n/a),this.columnCount=Math.round(o/a)-Math.round(s/a),d>=0&&95>=d&&(this.startingTileIndex=d,this.CLICK=e,this.allSelectedObjects=this._selectTilesFromRectangle(d,this.rowCount,this.columnCount,e),this._selectTiles(),this._addPreset(),this._applyValuesToTabs(),this.mainFabricCanvas.bringToFront(this.overLay)),!0},_selectTilesFromRectangle:function(t,e,a,i){var n=[];if(i)return n.push(this.allTiles[t]),n;for(var s=0,s=0;e>=s;s++){for(var l=0;a>=l;l++)n.push(this.allTiles[t+l]);t+=12}return n},_createDynamicRect:function(t){this.dynamicRect=new e.Rect({width:1,height:2,left:this.startX,top:this.startY,originX:"left",originY:"top",fill:null,strokeWidth:1.5,stroke:"#00506e"}),this.mainFabricCanvas.add(this.dynamicRect)},_createDynamicSingleRect:function(t){this.dynamicSingleRect=new e.Rect({width:this.spacing,height:this.spacing,left:this.startX,top:this.startY,originX:"left",originY:"top",fill:null,strokeWidth:1.5,stroke:"#00506e"}),this.mainFabricCanvas.add(this.dynamicSingleRect)},_addPreset:function(){if(this.allSelectedObjects&&this.previousPreset)for(var e=this.allSelectedObjects.length,a=0;e>a;a++){var i=this.allSelectedObjects[a];if(t.isEmptyObject(i.selectedWellAttributes))for(var n=this.allSelectedObjects[a].selectedWellAttributes,s=this.presetSettings[this.previousPreset].length,l=0;s>l;l++)n[this.presetSettings[this.previousPreset][l]]=!0}},_deselectSelected:function(){if(this.allSelectedObjects){for(var t=this.allSelectedObjects.length,e=0;t>e;e++){var a=this.allSelectedObjects[e];a.backgroundImg&&a.backgroundImg.setVisible(!1)}this.allSelectedObjects=[]}},_selectTiles:function(){for(var t=this.allSelectedObjects.length,e=0;t>e;e++){var a=this.allSelectedObjects[e];a.backgroundImg&&a.backgroundImg.setVisible(!0)}},_applyValuesToTabs:function(){if(1===this.allSelectedObjects.length)this._addDataToTabFields();else if(this.allSelectedObjects.length>1){for(var e=this.allSelectedObjects[0],a=e.wellData,i=e.unitData,n=(this.engine.getSelectedValues(e)||t.extend({},!0,e.wellData),!0),s=!0,l=0;l<this.allSelectedObjects.length;l++)if(n=this.compareObjects(this.allSelectedObjects[l].wellData,a),s=this.compareObjects(this.allSelectedObjects[l].unitData,i),!n||!s)return this._clearAllFields(a),!0;this._addDataToTabFields()}}}}}(jQuery,fabric),function(t,e){plateLayOutWidget["interface"]=function(){return{_createInterface:function(){var e="<div></div>";this.container=this._createElement(e).addClass("plate-setup-wrapper"),this.topSection=this._createElement(e).addClass("plate-setup-top-section"),this.topLeft=this._createElement(e).addClass("plate-setup-top-left"),this.topRight=this._createElement(e).addClass("plate-setup-top-right"),this.menuContainer=this._createElement(e).addClass("plate-setup-menu-container"),this.overLayContainer=this._createElement(e).addClass("plate-setup-overlay-container"),this.canvasContainer=this._createElement(e).addClass("plate-setup-canvas-container"),this._createMenu(),t(this.topLeft).append(this.menuContainer),this._createOverLay(),t(this.topLeft).append(this.overLayContainer),this._createCanvas(),t(this.topLeft).append(this.canvasContainer),t(this.topSection).append(this.topLeft),t(this.topSection).append(this.topRight),t(this.container).append(this.topSection),t(this.element).html(this.container),this._initiateFabricCanvas(),this._createTabAtRight(),this._createTabs(),this._placePresetCaption(),this._placePresetTabs(),this._bottomScreen(),this._canvas(),this.bottomForFirstTime()},_createElement:function(e){return t(e)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.menu=function(){return{_createMenu:function(){var e={Redo:{},Undo:{}},a=null,i=this;for(var n in e)a=this._createElement("<div></div>").html(n).addClass("plate-setup-menu-item"),t(a).on("click",function(e){"Undo"==t(this).html()?i.callUndo():"Redo"==t(this).html()&&i.callRedo()}),t(this.menuContainer).append(a)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.overlay=function(){return{copyCrieteria:{},_createOverLay:function(){var e=this;this.overLayTextContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-text-container"),t(this.overLayTextContainer).html("Completion Percentage:"),t(this.overLayContainer).append(this.overLayTextContainer),this.overLayButtonContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-button-container"),t(this.overLayContainer).append(this.overLayButtonContainer),this.clearCrieteriaButton=this._createElement("<button />").addClass("plate-setup-button"),t(this.clearCrieteriaButton).text("Clear Criteria"),t(this.overLayButtonContainer).append(this.clearCrieteriaButton),this.copyCrieteriaButton=this._createElement("<button />").addClass("plate-setup-button"),t(this.copyCrieteriaButton).text("Copy Criteria"),t(this.overLayButtonContainer).append(this.copyCrieteriaButton),this.pasteCrieteriaButton=this._createElement("<button />").addClass("plate-setup-button"),t(this.pasteCrieteriaButton).text("Paste Criteria"),t(this.overLayButtonContainer).append(this.pasteCrieteriaButton),t(this.clearCrieteriaButton).click(function(t){e.clearCrieteria()}),t(this.copyCrieteriaButton).click(function(t){e.copyCrieteria()}),t(this.pasteCrieteriaButton).click(function(t){e.pasteCrieteria()})},clearCrieteria:function(e){if(this.allSelectedObjects){for(var a=this.allSelectedObjects.length,i=0;a>i;i++){var n=this.allSelectedObjects[i];n.wellData=t.extend(!0,{},this.allWellData),n.unitData=t.extend(!0,{},this.allUnitData),n.selectedWellAttributes={},n.circle&&(this.mainFabricCanvas.remove(n.circle),this.mainFabricCanvas.remove(n.circleCenter),this.mainFabricCanvas.remove(n.circleText),delete this.engine.derivative[n.index],delete n.circle)}e||this._colorMixer(!0),this.updateOnClearCriteria&&this._trigger("updateWells",null,this.createObject())}},clearCrieteriaForAll:function(e){this._deselectSelected();for(var a in this.engine.derivative){var i=this.allTiles[a];i.wellData=t.extend(!0,{},this.allWellData),i.unitData=t.extend(!0,{},this.allUnitData),i.selectedWellAttributes={},i.circle&&(this.mainFabricCanvas.remove(i.circle),this.mainFabricCanvas.remove(i.circleCenter),this.mainFabricCanvas.remove(i.circleText),delete i.circle)}this.mainFabricCanvas.remove(this.dynamicRect),this.mainFabricCanvas.remove(this.dynamicSingleRect),this.engine.derivative={}},clearSingleCrieteria:function(e){e.wellData=t.extend(!0,{},this.allWellData),e.unitData=t.extend(!0,{},this.allUnitData),e.selectedWellAttributes={},e.circle&&(this.mainFabricCanvas.remove(e.circle),this.mainFabricCanvas.remove(e.circleCenter),this.mainFabricCanvas.remove(e.circleText),delete this.engine.derivative[e.index],delete e.circle)},copyCrieteria:function(){this.allSelectedObjects&&(this.commonWell=this.engine.findCommonValues("wellData"),this.commonUnit=this.engine.findCommonValues("unitData"))},pasteCrieteria:function(){this.commonWell&&(this.allSelectedObjects.filter(function(e,a){this.allTiles[e.index].wellData=t.extend(!0,{},this.commonWell),this.allTiles[e.index].unitData=t.extend(!0,{},this.commonUnit),this.engine.createDerivative(this.allTiles[e.index])},this),this._colorMixer(!0),this.mouseMove=this.allSelectedObjects.length>1?!0:!1,this.mainFabricCanvas.fire("mouse:up")),this.updateOnPasteCriteria&&this._trigger("updateWells",null,this.createObject())}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.preset=function(e){return{presetSettings:e.options.attributes.presets||{},previousPreset:"",_placePresetTabs:function(){this.presetTabContainer=this._createElement("<div></div>").addClass("plate-setup-preset-container"),this.showPresetTabs&&t(this.tabContainer).append(this.presetTabContainer);var e={"Preset 1":{},"Preset 2":{},"Preset 3":{},"Preset 4":{}},a=[],i=0;for(var n in e){var s=this._createElement("<div></div>").html(n).addClass("plate-setup-prest-tab-div");a[i++]=this._createElement("<div></div>").addClass("plate-setup-prest-tab").data("preset",n).append(s),t(this.presetTabContainer).append(a[i-1]);var l=this;t(a[i-1]).click(function(){l._presetClickHandler(this)})}},_presetClickHandler:function(e){
this.previousPreset==t(e).children().html().toLowerCase()?(t(e).removeClass("plate-setup-prest-tab-selected").addClass("plate-setup-prest-tab"),this.previouslyClickedPreset=null,this.previousPreset=""):(this.previouslyClickedPreset&&(t(this.previouslyClickedPreset).removeClass("plate-setup-prest-tab-selected").addClass("plate-setup-prest-tab"),this.onOffCheckBox(!0,this.previousPreset)),t(e).addClass("plate-setup-prest-tab-selected"),this.previouslyClickedPreset=e,this.previousPreset=t(e).data("preset").toLowerCase(),this.onOffCheckBox(!1,this.previousPreset))},onOffCheckBox:function(e,a){for(var i,n=this.presetSettings[a],s=this.presetSettings[a].length,l=0;s>l;l++)i=t("#"+n[l]).data("checkBox"),t(i).data("clicked",e).trigger("click",!0)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.redo=function(t){return{undoRedoArray:[],redo:function(t){this.getPlates(this.undoRedoArray[t]),this.undoRedoActive=!1}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.tabs=function(){return{allTabs:[],allWellData:{},allDataTabs:[],allUnitData:{},_createTabAtRight:function(){this.tabContainerId||0!==t("#"+this.tabContainerId).length?this.tabContainer=t("#"+this.tabContainerId).addClass("plate-setup-tab-container"):(this.tabContainer=this._createElement("<div></div>").addClass("plate-setup-tab-container"),t(this.topRight).append(this.tabContainer))},_createTabs:function(){this.tabHead=this._createElement("<div></div>").addClass("plate-setup-tab-head"),t(this.tabContainer).append(this.tabHead);var e=this.options.attributes.tabs,a=0;for(var i in e){this.allTabs[a++]=this._createElement("<div></div>").addClass("plate-setup-tab"),t(this.allTabs[a-1]).data("index",a-1).html(i);var n=this;t(this.allTabs[a-1]).click(function(){n._tabClickHandler(this)}),t(this.tabHead).append(this.allTabs[a-1])}this.tabDataContainer=this._createElement("<div></div>").addClass("plate-setup-tab-data-container"),t(this.tabContainer).append(this.tabDataContainer),this._addDataTabs(e),t(this.allTabs[0]).click(),this._addTabData()},_tabClickHandler:function(e){if(this.selectedTab){t(this.selectedTab).removeClass("plate-setup-tab-selected").addClass("plate-setup-tab");var a=t(this.selectedTab).data("index");t(this.allDataTabs[a]).css("z-index",0)}t(e).addClass("plate-setup-tab-selected"),this.selectedTab=e;var i=t(e).data("index");t(this.allDataTabs[i]).css("z-index",1e3)},_addDataTabs:function(e){var a=0;for(var i in e)this.allDataTabs[a++]=this._createElement("<div></div>").addClass("plate-setup-data-div").css("z-index",0),t(this.tabDataContainer).append(this.allDataTabs[a-1])},_placePresetCaption:function(){this.showPresetTabs&&(this.wellAttrContainer=this._createElement("<div></div>").addClass("plate-setup-well-attr-container").html("Well Attribute Tabs"),t(this.tabContainer).append(this.wellAttrContainer))},_createDefaultFieldForTabs:function(){var e=this._createElement("<div></div>").addClass("plate-setup-tab-default-field"),a=this._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),i=this._createElement("<div></div>").addClass("plate-setup-tab-field-right-side "),n=this._createElement("<div></div>").addClass("plate-setup-tab-name"),s=this._createElement("<div></div>").addClass("plate-setup-tab-field-container");return t(i).append(n),t(i).append(s),t(e).append(a),t(e).append(i),e}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.undoRedoManager=function(e){return{undoRedoArray:[],actionPointer:null,addToUndoRedo:function(e){null!=this.actionPointer&&this.actionPointer<this.undoRedoArray.length-1&&this.undoRedoArray.splice(this.actionPointer+1,this.undoRedoArray.length),this.actionPointer=null,this.undoRedoArray.push(t.extend(!0,{},e))},_configureUndoRedoArray:function(){var e={checkboxes:{},derivative:{},selectedObjects:{startingTileIndex:0,rowCount:1,columnCount:1,click:!0,selectionRectangle:{type:"dynamicSingleRect",width:48,height:48,left:45,top:36,mouseMove:!1}}};this.undoRedoArray.push(t.extend({},e))},_handleShortcuts:function(t){90==t.keyCode&&t.ctrlKey&&this.callUndo(),89==t.keyCode&&t.ctrlKey&&this.callRedo()},callUndo:function(){this.undoRedoActive=!0,null==this.actionPointer?(this.actionPointer=this.undoRedoArray.length-2,this.undo(this.actionPointer)):(this.actionPointer=this.actionPointer?this.actionPointer-1:0,this.undo(this.actionPointer)),this.updateOnUndoRedo&&this._trigger("updateWells",null,this.createObject())},callRedo:function(){this.undoRedoActive=!0,null!=this.actionPointer&&this.actionPointer<this.undoRedoArray.length-1?(this.actionPointer=this.actionPointer+1,this.redo(this.actionPointer),this.updateOnUndoRedo&&this._trigger("updateWells",null,this.createObject())):this.actionPointer==this.undoRedoArray.length-1&&(this.undoRedoActive=!1)}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.undo=function(t){return{undoRedoArray:[],undo:function(t){this.getPlates(this.undoRedoArray[t]),this.undoRedoActive=!1}}}}(jQuery,fabric),function(t,e){plateLayOutWidget.unitDataField=function(){return{_addUnitDataField:function(e,a,i){var n=this,s=this._addUnitDropDown(i);return t(e[a-1]).find(".plate-setup-tab-field-container").append(s),t("#"+i.id+"unit").select2({}),this.allUnitData[i.id+"unit"]=t("#"+i.id+"unit").val(),t("#"+i.id+"unit").on("change",function(t,e){"Automatic"!=e&&n._addUnitData(t)}),s},_addUnitDropDown:function(e){if(e.units){var a=this._createElement("<select></select>").attr("id",e.id+"unit").addClass("plate-setup-tab-label-select-field");for(unit in e.units){var i=this._createElement("<option></option>").attr("value",e.units[unit]).html(e.units[unit]);t(a).append(i)}return a}}}}}(jQuery,fabric);